<!-- src/app/shared/utils/dev-debug/dev-debug.component.html -->
<details class="debug-panel">
  <summary>
    ğŸ› ï¸ Signal Health
    <span [ngClass]="overallHealthClass()">{{ overallHealth() }}</span>
  </summary>

  <!-- Signal Health Matrix -->
  <div class="health-grid">
    <div class="health-item" [ngClass]="getHealthClass(authHealth())">
      <strong>Auth</strong>
      <span>{{ authHealth().status }}</span>
      <small>{{ authHealth().details }}</small>
    </div>

    <div class="health-item" [ngClass]="getHealthClass(pubHealth())">
      <strong>Pubs</strong>
      <span>{{ pubHealth().status }}</span>
      <small>{{ pubHealth().details }}</small>
    </div>

    <div class="health-item" [ngClass]="getHealthClass(locationHealth())">
      <strong>Location</strong>
      <span>{{ locationHealth().status }}</span>
      <small>{{ locationHealth().details }}</small>
    </div>

    <div class="health-item" [ngClass]="getHealthClass(checkinHealth())">
      <strong>Checkins</strong>
      <span>{{ checkinHealth().status }}</span>
      <small>{{ checkinHealth().details }}</small>
    </div>

    <div class="health-item" [ngClass]="getHealthClass(landlordHealth())">
      <strong>Landlords</strong>
      <span>{{ landlordHealth().status }}</span>
      <small>{{ landlordHealth().details }}</small>
    </div>
  </div>

  <!-- Check-in Eligibility Section -->
  <div class="checkin-section">
    <h4>ğŸ¯ Check-in Eligibility Flow</h4>

    <div class="checkin-steps">
      <div class="step" [ngClass]="getStepClass(checkinStep1())">
        <strong>1. Auth:</strong> {{ checkinStep1().status }}
        <small>{{ checkinStep1().details }}</small>
      </div>

      <div class="step" [ngClass]="getStepClass(checkinStep2())">
        <strong>2. Location:</strong> {{ checkinStep2().status }}
        <small>{{ checkinStep2().details }}</small>
      </div>

      <div class="step" [ngClass]="getStepClass(checkinStep3())">
        <strong>3. Pubs:</strong> {{ checkinStep3().status }}
        <small>{{ checkinStep3().details }}</small>
      </div>

      <div class="step" [ngClass]="getStepClass(checkinStep4())">
        <strong>4. Range:</strong> {{ checkinStep4().status }}
        <small>{{ checkinStep4().details }}</small>
      </div>

      <div class="step" [ngClass]="getStepClass(checkinStep5())">
        <strong>5. Eligibility:</strong> {{ checkinStep5().status }}
        <small>{{ checkinStep5().details }}</small>
      </div>

      <div class="step" [ngClass]="getStepClass(checkinStep6())">
        <strong>6. Landlord:</strong> {{ checkinStep6().status }}
        <small>{{ checkinStep6().details }}</small>
      </div>
    </div>

    <div class="final-result" [ngClass]="getFinalResultClass()">
      <strong>CAN CHECK IN:</strong> {{ canCheckInFinal() ? 'âœ… YES' : 'âŒ NO' }}
    </div>
  </div>

  <!-- Enhanced Pub Data Section -->
  <div class="pub-section">
    <h4>ğŸ“ Pub Data Reality Check</h4>
    <div class="pub-grid">
      <span><strong>Total Pubs:</strong> {{ totalPubs() }}</span>
      <span><strong>Pubs Loading:</strong> {{ pubStore.loading() ? 'YES' : 'NO' }}</span>
      <span><strong>Nearby Pubs:</strong> {{ nearbyPubsCount() }}</span>
      <span><strong>Location Available:</strong> {{ nearbyPubStore.location() ? 'YES' : 'NO' }}</span>

      @if (closestPub()) {
        <div class="closest-pub">
          <strong>Closest Pub:</strong>
          <span>{{ closestPub()!.name }}</span>
        </div>
      } @else {
        <span class="no-data">âŒ No closest pub</span>
      }

      <span><strong>Can Check In (Store):</strong> {{ canCheckIn() ? 'âœ…' : 'âŒ' }}</span>
      <span><strong>Can Check In (Final):</strong> {{ canCheckInFinal() ? 'âœ…' : 'âŒ' }}</span>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="activity-section">
    <h4>ğŸ• Recent Activity</h4>
    <div class="activity-grid">
      <span><strong>Today's Check-ins:</strong> {{ todayCheckinsCount() }}</span>
      <span><strong>Latest Check-in:</strong> {{ latestCheckinPub() || 'None' }}</span>

      @if (landlordToday().length > 0) {
        <div class="landlord-today">
          <strong>Landlord Today:</strong>
          <span>{{ landlordToday().join(', ') }}</span>
        </div>
      } @else {
        <span>ğŸ‘‘ No landlord pubs today</span>
      }
    </div>
  </div>

  <!-- Landlord Section -->
  <div class="landlord-section">
    <h4>ğŸ‘‘ Landlord Reality Check</h4>
    <div class="landlord-grid">
      <span><strong>My Landlord Pubs:</strong> {{ landlordDebugData().userLandlordPubs.length }}</span>
      <span><strong>Pubs Checked:</strong> {{ landlordDebugData().totalLandlordPubs }}</span>
      <span><strong>With Landlords:</strong> {{ landlordDebugData().pubsWithLandlords.length }}</span>
      <span><strong>No Landlords:</strong> {{ landlordDebugData().pubsWithoutLandlords.length }}</span>

      @if (landlordDebugData().userLandlordPubs.length > 0) {
        <div class="my-landlord-pubs">
          <strong>ğŸ‘‘ I'm Landlord Of:</strong>
          @for (pub of landlordDebugData().userLandlordPubs; track pub.pubId) {
            <div class="landlord-pub">
              <span class="pub-name">{{ pub.pubName }}</span>
              <span class="claim-time">{{ pub.claimedAt }}</span>
            </div>
          }
        </div>
      } @else {
        <span class="no-landlord-pubs">ğŸ´ No landlord pubs today</span>
      }

      @if (closestPub()) {
        <div class="closest-pub-landlord">
          <strong>Closest Pub Landlord:</strong>
          @if (landlordStore.get(closestPub()!.id); as landlord) {
            <span class="has-landlord">{{ landlord.userId.slice(0, 8) }}...</span>
          } @else {
            <span class="no-landlord">ğŸ´ Available to claim!</span>
          }
        </div>
      }
    </div>

    <!-- Detailed landlord breakdown -->
    <details class="landlord-details">
      <summary>All Landlord Data ({{ landlordDebugData().pubsWithLandlords.length }} active)</summary>

      @if (landlordDebugData().pubsWithLandlords.length > 0) {
        <div class="landlord-list">
          @for (entry of landlordDebugData().pubsWithLandlords; track entry.pubId) {
            <div class="landlord-entry" [class.is-me]="entry.isCurrentUser">
              <span class="pub-name">{{ entry.pubName }}</span>
              <span class="landlord-user">{{ entry.landlordUserId.slice(0, 8) }}{{ entry.isCurrentUser ? ' (ME)' : '' }}</span>
              <span class="claim-time">{{ entry.claimedAt }}</span>
            </div>
          }
        </div>
      }

      @if (landlordDebugData().pubsWithoutLandlords.length > 0) {
        <div class="no-landlord-list">
          <strong>Pubs without landlords:</strong>
          @for (entry of landlordDebugData().pubsWithoutLandlords; track entry.pubId) {
            <span class="pub-no-landlord">{{ entry.pubName }}</span>
          }
        </div>
      }
    </details>
  </div>

  <!-- Device Capabilities -->
  <div class="device-section">
    <h4>ğŸ“± Device Reality Check</h4>
    <div class="device-grid">
      <span>Screen: {{ deviceInfo().screen }}</span>
      <span>Memory: {{ deviceInfo().memory }}</span>
      <span>Connection: {{ deviceInfo().connection }}</span>
      <span>Touch: {{ deviceInfo().touch ? 'ğŸ‘†' : 'ğŸ–±ï¸' }}</span>
      <span>Battery: {{ deviceInfo().battery }}</span>
      <span>Platform: {{ deviceInfo().platform }}</span>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="actions">
    <button (click)="refreshAll()" [disabled]="refreshing()">
      {{ refreshing() ? 'ğŸ”„' : 'ğŸ”„' }} Refresh All
    </button>
    <button (click)="setTestLocationNearPub()">ğŸ“ Set Test Location</button>
    <button (click)="refreshLandlords()">ğŸ‘‘ Refresh Landlords</button>
    <button (click)="loadLandlordForClosestPub()">ğŸƒ Load Closest Pub Landlord</button>
    <button (click)="resetAuth()">ğŸ” Reset Auth</button>
    <button (click)="resetPubs()">ğŸ  Reset Pubs</button>
    <button (click)="resetCheckins()">âœ… Reset Check-ins</button>
    <button (click)="copyDiagnostics()">ğŸ“‹ Copy All Data</button>
  </div>

  <!-- Raw Signal Values (Collapsed) -->
  <details class="raw-signals">
    <summary>Raw Signal Values</summary>
    <pre class="raw-data">{{ rawSignals() | json }}</pre>
  </details>
</details>
