<app-new-home></app-new-home>

<div class="home-container">

  <!-- üëã Welcome Section -->
  <section class="welcome">
    <h1>Welcome, {{ authStore.userDisplayName() }}!</h1>

    @if (authStore.isAnonymous()) {
      <div class="anonymous-actions">
        <p>Customize your pub crawling experience:</p>
        <div class="action-buttons">
          <app-button
            variant="secondary"
            (onClick)="changeUsername()"
            icon="edit"
          >
            Change Name
          </app-button>

          <app-button
            variant="primary"
            (onClick)="upgradeToFullAccount()"
            icon="upgrade"
          >
            Sign up with Google
          </app-button>
        </div>
      </div>
    }
  </section>

  <!-- üèÜ HERO: Big imposing pub count -->
  <app-pub-progress-hero
    [visitedCount]="visitedPubsCount()"
    [totalPubs]="totalPubs()"
    [hasProgress]="hasProgressData()"
  />

  <!-- ‚úÖ Check-in Widget -->
  @if (closestPub() && userCanCheckIn()) {
    <app-check-in-homepage-widget
      [closestPub]="closestPub()!"
    />
  } @else if (closestPub() && !userCanCheckIn()) {
    <div class="already-checked-in">
      <h3>{{ closestPub()!.name }}</h3>
      <p>‚úÖ You've already checked in today!</p>
      <small>Distance: {{ (closestPub()!.distance / 1000).toFixed(1) }}km</small>
    </div>
  } @else {
    <div class="no-nearby-pubs">
      <h3>üïµÔ∏è No Nearby Pubs</h3>
      <p>No pubs found within range. Keep exploring!</p>
    </div>
  }

  <!-- üç∫ Nearby Pubs List -->
  @if (nearestPubs().length > 0) {
    <div class="nearby-pubs">
      <h2>üìç Nearby Pubs ({{ nearestPubs().length }})</h2>
      <ul class="pub-list">
        @for (pub of nearestPubs(); track pub.id) {
          <li class="pub-item">
            <div class="pub-info">
              <h4>{{ pub.name }}</h4>
              <small>{{ (pub.distance / 1000).toFixed(1) }}km away</small>
            </div>
            @if (checkinStore.hasCheckedInToday(pub.id)) {
              <span class="checked-in-badge">‚úÖ Visited today</span>
            }
          </li>
        }
      </ul>
    </div>
  }

  <!-- üèÖ User Badges -->
  @if (badgeStore && badgeStore.data().length > 0) {
    <app-user-badges [badges]="badgeStore.data" />
  }

  <!-- üîÑ Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <p>üîÑ Loading your pub data...</p>
    </div>
  }
</div>
