<div class="home-container">

  <app-checkin-button [pubId]="'jj-moons-wembley'" />

  <h2>temp test check in</h2>
  <!-- button to go to /test-carpet screen -->
   <button routerLink="/test-carpet">Tets carpet</button>



   <!-- âœ… Temporary carpet testing section -->
  <div class="carpet-testing-section" style="margin-top: 2rem; padding: 1rem; border: 2px dashed #ccc; border-radius: 8px;">
    <h3>ğŸ§ª Carpet Scanner Testing</h3>

    @if (!showCarpetTest()) {
      <!-- Test controls -->
      <div class="test-controls">
        <button
          class="btn-primary"
          (click)="startCarpetTest()">
          ğŸ¯ Test Carpet Scanner
        </button>

        <button
          class="btn-secondary"
          (click)="updatePhotoStats()">
          ğŸ“Š Check Storage Stats
        </button>

        <button
          class="btn-danger"
          (click)="clearAllPhotos()">
          ğŸ§¹ Clear All Photos
        </button>
      </div>

      <!-- Show last captured photo info -->
      @if (lastCapturedPhoto()) {
        <div class="last-photo-info" style="margin-top: 1rem; padding: 1rem; background: #f0f0f0; border-radius: 8px;">
          <h4>ğŸ“¸ Last Captured Photo</h4>
          <p><strong>File:</strong> {{ lastCapturedPhoto()!.filename }}</p>
          <p><strong>Format:</strong> {{ lastCapturedPhoto()!.format.toUpperCase() }}</p>
          <p><strong>Size:</strong> {{ lastCapturedPhoto()!.sizeKB }}KB</p>
          @if (lastCapturedPhoto()!.metadata) {
            <p><strong>Edges:</strong> {{ lastCapturedPhoto()!.metadata!.edgeCount }}</p>
            <p><strong>Blur Score:</strong> {{ lastCapturedPhoto()!.metadata!.blurScore }}</p>
            <p><strong>Confidence:</strong> {{ (lastCapturedPhoto()!.metadata!.confidence! * 100).toFixed(0) }}%</p>
          }

          <button
            class="btn-small"
            (click)="displaySavedPhoto(lastCapturedPhoto()!.filename)">
            ğŸ‘ï¸ View Photo
          </button>
        </div>
      }

      <!-- Show storage stats -->
      @if (photoStats()) {
        <div class="storage-stats" style="margin-top: 1rem; padding: 1rem; background: #e8f5e8; border-radius: 8px;">
          <h4>ğŸ’¾ Storage Statistics</h4>
          <p><strong>Total Photos:</strong> {{ photoStats().count }}</p>
          <p><strong>Total Size:</strong> {{ photoStats().totalSizeKB }}KB</p>
          <p><strong>Average Size:</strong> {{ photoStats().averageSizeKB }}KB</p>
          <p><strong>Savings:</strong> {{ photoStats().estimatedSavings }}</p>

          @if (photoStats().formats) {
            <div class="format-breakdown">
              <h5>ğŸ“Š Format Breakdown:</h5>

              {{ photoStats() | json }}

            </div>
          }
        </div>
      }

    } @else {
      <!-- Carpet Scanner (fullscreen) -->
      <app-carpet-scanner
        (carpetConfirmed)="onCarpetConfirmed($event)"
        (exitScanner)="onExitCarpetTest()">
      </app-carpet-scanner>
    }
  </div>





  <app-user-profile-widget
  [user]="user()"
  [leaderboardPosition]="userLeaderboardPosition()"
  (openProfile)="handleOpenProfile()" />

    <!-- âœ… Onboarding Hint -->
    @if (isNewUser()) {
      <div class="onboarding-hint">
        <span class="hint-icon">ğŸ’¡</span>
        <span class="hint-text">
          Welcome to Spoonscount! Start a mission to begin your pub adventure.
        </span>
      </div>
    }

  <app-scoreboard-hero [data]="scoreboardData()" />


  @if (carpets().length > 0 || carpetsLoading()) {
    <app-carpet-grid
      [carpets]="carpets"
      [loading]="carpetsLoading"
    />
  }


  <!-- âœ… Badges Showcase -->
  @if (earnedBadges().length > 0) {
    <app-badges-showcase
      [badges]="earnedBadges()"
      [maxDisplay]="6"
      (viewAllBadges)="handleViewAllBadges()" />
  }

  <!-- âœ… Active Missions -->
  @if (activeMissions().length > 0) {
    <app-missions-section
      [missions]="activeMissions()"
      [maxDisplay]="3"
      (viewMission)="handleViewMission($event)" />
  }

  <!-- âœ… Action Cards -->
  <!-- <app-action-cards
    [showStartMission]="activeMissions().length === 0"
    (startMission)="handleStartMission()"
    (openGuide)="handleOpenGuide()"
    (openSettings)="handleOpenSettings()" /> -->



  <!-- âœ… Development Debug Section -->
  <!-- @if (isDevelopment()) {
    <details class="debug-section">
      <summary>ğŸ› Debug Information</summary>
      <div class="debug-grid">
        <div class="debug-item">
          <h4>User State</h4>
          <pre>{{ debugUserInfo() | json }}</pre>
        </div>
        <div class="debug-item">
          <h4>Stores Status</h4>
          <pre>{{ debugStoresInfo() | json }}</pre>
        </div>
      </div>
    </details>
  } -->
</div>
